# Memory Layout (x86)

Sebelum memahami lebih lanjut tentang binary exploitation kita harus mengerti tentang dasar-dasar layout memory


<img src=layoutmemoryx86.png alt="memory layout" width=300 />


Berikut adalah layout memory dari sebuah program ELF yang di-*load* kedalam memory. 
alamat diatas adalah *low address memory* dan semakin kebawah maka akan menujuh *high address memory*

ada beberapa segemen dalam memory layout:
* *text* , untuk menyimpan kode assembly (instruksi dalam program)
* *data* , untuk menyipan variable global
* *bss* , *uninitiated variable*, variable yang tidak terinisiasi
* *Heap*, adalah data dinamis yang dipesan dalam proses **malloc , new obj**, tumbuh dari alamat memory rendah ke tinggi
* *stack*, adalah data dinamis yang memuat *local variable*, tumbuh dari alamat memory tinggi ke rendah
* *argv*, parameter yang dimasukkan ke ELF
* *environment variable*, variable yang berasal dari OS
* *kernel space*, khusus untuk kernel, tidak bisa dimanipulasi oleh program

gambar diatas adalah layout memori tanpa pengamanan ASRL (*Address Space Layout Radomization*). ASLR menambahkan offset random, yang membuat alamat heap tidak langsung menempel ke segmen bss

<img src=layoutmemoryx86aslr.png alt="memory layout" width=350 />

### layout stack
menyimpan data dan memanggil fungsi, 
dalam x86 parameter fungsi dikirim (*push*) melalui struktur data *stack* yang diambil dari nilai paramter terbesar hingga parameter terkecil

<img src=stacklayout.png alt="stack layout x86" width=350 />

didalam layout stack, setiap alamat memory setiap fungsi diapit oleh EBP(*high memory*) dan ESP(*low memory*),yang diapit EBP dan ESP disebut juga sebagai ***stack frame***

Ketika terjadi call fungsi program akan mempush alamat ketika program dipanggil, dan kemudian maka program akan menuju ke fungsi dan menjalankan fungsi tersebut.\
Ketika didalam fungsi, program akan menyimpan EBP, yang merupakan stack pointer dari fungsi yang memanggil, agar dapat dikembalikan ke fungsi yang memanggil tersebut.\
Kemudian program akan men-setup stack untuk menyimpan variable-variable local yang diiinput.\
Ketika algoritma fungsi sudah selesai bekerja maka akan dikembalikan ke fungsi yang memanggil.

### layout stack (x86-64)
Konsep dari layout stack 64-bit hampir sama dengan dengan 32-bit\
terdapat Perbedaan pada saat passing parameter yang tidak melalui stack, tetapi melalui register yang sudah memliki ketentuan tertentu. dapat dilihat [disini](http://6.s081.scripts.mit.edu/sp18/x86-64-architecture-guide.html)

<img src=stacklayout64.png alt="stack layout x86-64" width=350 />

